language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: QBEKJ3gYmClRYKPHfEOikG88dfhL9knt5uKVkuE/Q5DZezLY2M2XIw1UHKrDX9+HtFcaSnFmv7TY59R8s//jv/xrgakY0WoNNwaeVbpHpDaY1lHgwV1afQG49EETK2KuisPDIXtj6RAcTo463qF2gGqtXfKopbLYPx17OWkedjJNoo/fFRgxEFdNZP5t1OoKrMxon3IAktXgVK1gTxovWvB6JIepvgIGJA9AJEtDNVTuvAmhMJXlj3gq2j8jgvL6jdCOuD/lU40plM4UrFlG0UjDgzD0UqVd44Y3ucOODIfjPj51Uzws16xCvFiXwkLGkfkrSqSkFlKzyn2DRHQ1MwIY3k9KqveUd39er1eNBG0DEEby8mF8jZuiaMlHwyrzPegjSe5xLdWyIc/8nJ0A/4ifDaxW0+IO+/Lka/jUOAll+bdiTJMSqK76c7H/LO20kn7M5FQQzZM5m4aJQFy33rAVSyvVnYk0Eg/Wp8mEsB+BP72gY+GKi/klGPANI4+8/D4ADSx+NKPSTnrG+kk0rdMTIU/hdCEspwxCgOSzHhsU9WKALLMuakdPfIjGlxseu1MIyWBHRHC0keYQPIHc0vluBhypd/kKNWg3CuFI9CBVz+4nIoLOhWTgX7qbqv2au4vD4kspKB+c4TQpC1+MJfv7VnL9RnA75XojsvJDqYs=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
