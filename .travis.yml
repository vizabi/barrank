language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: ZRbYH5ePlhQ5cgMsjT7xk1D5YU3oQAPI1G4ZgBYqHclqKhHEYEplG+Eud9CfetZSN2nLozIi+A66Ss0y4JH9+oEXLlevkrxVUS5WHseRD8b1z3ZM/6U/9lrMybNhdzDv2Z46DmXgverjExmbLZ9TtXSon2hZR0ir4z1SyiSWdrysKBu3V2MIMGDDBTw2RvE5wH+5EX6m9lLxD5YiEkaPzsDncElmFlH2ve/LE4LWkKmJn6LsuN9dMNRKB2oc6xUvYntmCV7pHEnXjatu+R4Ro/xXUji294NSNxx1AYAaCmSNWpbe6L5Z0ZPdaCyQJBsR+7N4DIjuligNm0ZXgEqn91IMeqDC8GkoXEs+xYh9//7vR2BHhPC1EClEXlqhaP+qRj+yrwpC/bRfKxvIFDxlYtVhU4qr3WDR5yR0ho7w8Hi0gOmJwi7PoZ19ApeFRvc1pNZphhPTghJRqA0idoziZomjvlxht1Zcl1e9p5/IDmrzJCYe3OdcFurhettxW0WUBmuaOPumwFoTxWCzUUz5azkxJq7DrwgY46/c/LsUI2Tq4pO4USI91Uj2eqarR7Ha3LTaLyuW/fA6QW+Xgcladz7MoEipEclIlx1NH75RgcPkevZ1ODnvvC5dFPkVRY8vqlFUVX9tjpOfslSnhVXVhxBr0hcVuRKFFXO2yDHxyc4=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
